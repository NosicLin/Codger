<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>状态的结构</TITLE>
<META NAME="description" CONTENT="状态的结构">
<META NAME="keywords" CONTENT="index">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="index.css">

<LINK REL="next" HREF="node17.html">
<LINK REL="previous" HREF="node15.html">
<LINK REL="up" HREF="node14.html">
<LINK REL="next" HREF="node17.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html293"
  HREF="node17.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="/usr/share/latex2html/icons/next.png"></A> 
<A NAME="tex2html291"
  HREF="node14.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="/usr/share/latex2html/icons/up.png"></A> 
<A NAME="tex2html285"
  HREF="node15.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="/usr/share/latex2html/icons/prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html294"
  HREF="node17.html">识别算法</A>
<B> Up:</B> <A NAME="tex2html292"
  HREF="node14.html">词法识别算法</A>
<B> Previous:</B> <A NAME="tex2html286"
  HREF="node15.html">状态链简介</A>
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00032000000000000000">
状态的结构</A>
</H2>
状态链算法中，许多的状态链接在一起构成一个有限状态机，在每个状态中都会保存与该状态相关的基本信息，这些信息有：

<OL>
<LI>状态是否为终态，如果是终态，同时也会保存该状态所属单词的类型，单词类型用于后面的语法分析。
</LI>
<LI>字符映射数组：字符射数组长度为256，codger源程序是由字符序列组成，每当解析器从源程序中读出一个字符时，该字符的值的范围为：0到255，然后从字符映射数组获得输入事件类型。
</LI>
<LI>状态能接受的输入事件类型，以及在该输入类型下所转换到的后继状态。
</LI>
</OL>
用程序来描述为(attr表示属性定义)：<PRE>
class State
    attr finally        #是否为终态
    attr token          #单词的类型
    attr input_map[256] #字符映射数组
    attr targets[]      #后继状态
end
</PRE>
例如：假设状态a为不为终态，在字符`0'到`9'下转移到状态b，在`a'到`f'下转移到状态c，在其它状态下，转换到错误状态。为状态a构造状态数据为：<PRE>
State a
    finally=false
    token="unkown"
    input_map=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
               1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
               0,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
                       .........
               0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    targets=[err,b,c]
end
</PRE>

<P>
其中在input_map中的省略号为112个0，状态a总共能接受三种输入事件类型，由于数组脚标从零开始，所以三种输入事件类型分别称为输入事件0，输入事件1，输入事件2

<OL>
<LI>输人字符`0'到`9'会被映射为第1种输入事件类型，状态a在该输入类型下会转移到后继状态b，状态b保存在targets中的脚标为1的位置
</LI>
<LI>输入字符`a'到`f'会被映射为第2种输入事件类型，状态a在该输入类型下会转移到后继状态c，状态c保存在targets中的脚标为2的位置
</LI>
<LI>除`0'到`9'和`a'到`f'以外的所有字符会被映射到第0种输入事件类型，状态a在该输类型下会转移到后断状态err，状态err保存在targets中的脚标为0的位置。状态err是一个内置状态，用于表示源程于中单词存在错误。
</LI>
</OL>

<P>
input_map是一个256位的数组，数组元素类型为unsigned char， unsigned char占用一个字节，即一个input_map需要256字节。但并不是每个状态都需要独自拥有一个字符映射数组。在很多情况下，许多状态的输入事件类型相似，或者是完全相同，它们可以建立一个公有的字符映射数组，用于共享，以提高内存的利用率。例如状态a在符号`c'到`z'转换到状态c，状态b在字符`a'到`f'能转换到状态c，虽然状态a与状态b能接受的输入事件类型不同，但是可能通过合并状态a与状态b输入事件，让它们共享一个字符映射数组。合并方法为：提取出字符`c'到z'与字符`a'到`f'两个序列范围的交集部分为：字符`c'到`f'，即现在的有四种输入类型
<BLOCKQUOTE>
1) 类型0, 字符`a'到`b' 
<BR>
2) 类型1, 字符`c'到`f' 
<BR>
3) 类型2, 字符`g'到`z' 
<BR>
4) 类型3, 除前面字符以外的所有字符。 

</BLOCKQUOTE>
以前状态a是在字符`c'到`z'转换到状态c，现在改为在字符`a'到`b'与字符`c' 到 `f'的情况下转换到c；以前状态b是在字符`c'到`z'转换到状态c，现在改为在字符`c'到`f'与字符`g'到`z'的情况下转移到状态c。在合并字符映射数组后，a的后继状态数组改为[c,c,err,err]，b的后继状态数组为[err,c,c,err]。

<P>
Codger解析器的词法识别模块大约有90多个状态和10字符映射组成，基本上每种单词类型的所有状态共享一个状态映射数组。词法识别模块所占用的内存大约在4k左右。
<BR><HR>
<ADDRESS>
NosicLin
2012-06-03
</ADDRESS>
</BODY>
</HTML>
